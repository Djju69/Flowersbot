<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Товары</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; padding: 24px; }
      .wrap { max-width: 1200px; margin: 0 auto; }
      .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
      .btn { padding: 8px 12px; background: #111827; color: white; text-decoration: none; border-radius: 6px; font-size: 14px; }
      .btn-sm { padding: 4px 8px; font-size: 12px; }
      .btn-danger { background: #dc2626; }
      .btn-secondary { background: #6b7280; }
      .filters { display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }
      .filters input, .filters select { padding: 6px 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px; }
      table { width: 100%; border-collapse: collapse; border: 1px solid #e5e7eb; }
      th, td { padding: 8px 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }
      th { background: #f9fafb; font-weight: 600; }
      .status { padding: 2px 6px; border-radius: 4px; font-size: 12px; }
      .status-available { background: #dcfce7; color: #166534; }
      .status-unavailable { background: #fef2f2; color: #dc2626; }
      .status-popular { background: #fef3c7; color: #d97706; }
      .actions { display: flex; gap: 4px; }
      .pagination { display: flex; justify-content: center; gap: 8px; margin-top: 20px; }
      .pagination a { padding: 6px 10px; border: 1px solid #d1d5db; text-decoration: none; border-radius: 4px; }
      .pagination .current { background: #111827; color: white; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="header">
        <h1 style="margin:0;">Товары ({{ total }})</h1>
        <div>
          <a href="/admin/products/new" class="btn">Создать товар</a>
          <a href="/admin/logout" class="btn btn-secondary">Выйти</a>
        </div>
      </div>

      <form method="get" class="filters">
        <input name="q" placeholder="Поиск..." value="{{ q }}" />
        <select name="category">
          <option value="">Все категории</option>
          {% for c in ["roses","exotic","mix","mono"] %}
          <option value="{{ c }}" {% if category == c %}selected{% endif %}>{{ c }}</option>
          {% endfor %}
        </select>
        <select name="available">
          <option value="">Все</option>
          <option value="true" {% if available == true %}selected{% endif %}>В наличии</option>
          <option value="false" {% if available == false %}selected{% endif %}>Недоступны</option>
        </select>
        <select name="popular">
          <option value="">Все</option>
          <option value="true" {% if popular == true %}selected{% endif %}>Популярные</option>
        </select>
        <select name="sort">
          <option value="created_at" {% if sort == "created_at" %}selected{% endif %}>По дате</option>
          <option value="name" {% if sort == "name" %}selected{% endif %}>По имени</option>
          <option value="price" {% if sort == "price" %}selected{% endif %}>По цене</option>
        </select>
        <select name="order">
          <option value="desc" {% if order == "desc" %}selected{% endif %}>По убыванию</option>
          <option value="asc" {% if order == "asc" %}selected{% endif %}>По возрастанию</option>
        </select>
        <button type="submit" class="btn btn-sm">Фильтр</button>
      </form>

      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Название</th>
            <th>Категория</th>
            <th>Цена</th>
            <th>Статус</th>
            <th>Действия</th>
          </tr>
        </thead>
        <tbody>
          {% for item in items %}
          <tr>
            <td>{{ item.id }}</td>
            <td>{{ item.name }}</td>
            <td>{{ item.category }}</td>
            <td>{{ "{:,.0f}".format(item.price).replace(","," ") }} ₫</td>
            <td>
              {% if item.is_available %}
              <span class="status status-available">В наличии</span>
              {% else %}
              <span class="status status-unavailable">Недоступен</span>
              {% endif %}
              {% if item.is_popular %}
              <span class="status status-popular">Популярный</span>
              {% endif %}
            </td>
            <td class="actions">
              <a href="/admin/products/{{ item.id }}" class="btn btn-sm">Редактировать</a>
              <a href="/admin/products/{{ item.id }}/toggle-available" class="btn btn-sm btn-secondary">
                {% if item.is_available %}Скрыть{% else %}Показать{% endif %}
              </a>
              <a href="/admin/products/{{ item.id }}/toggle-popular" class="btn btn-sm btn-secondary">
                {% if item.is_popular %}Убрать из популярных{% else %}Сделать популярным{% endif %}
              </a>
              <a href="/admin/products/{{ item.id }}/delete" class="btn btn-sm btn-danger" 
                 onclick="return confirm('Удалить {{ item.name }}?')">Удалить</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      {% if total > per_page %}
      <div class="pagination">
        {% if page > 1 %}
        <a href="?page={{ page - 1 }}&q={{ q }}&category={{ category }}&available={{ available }}&popular={{ popular }}&sort={{ sort }}&order={{ order }}">←</a>
        {% endif %}
        <span class="current">{{ page }}</span>
        {% if page * per_page < total %}
        <a href="?page={{ page + 1 }}&q={{ q }}&category={{ category }}&available={{ available }}&popular={{ popular }}&sort={{ sort }}&order={{ order }}">→</a>
        {% endif %}
      </div>
      {% endif %}
    </div>
  </body>
</html>
